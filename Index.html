<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Nh·∫≠p Li·ªáu Th√†nh Ph·∫©m Giao ƒê√≥ng Th√πng</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 15px;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px 20px;
      text-align: center;
      position: relative;
    }
    
    .header h1 {
      font-size: 22px;
      margin-bottom: 5px;
    }
    
    .header p {
      font-size: 13px;
      opacity: 0.9;
    }
    
    .network-status {
      position: absolute;
      top: 10px;
      right: 15px;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .network-status.online {
      background: #28a745;
      color: white;
    }
    
    .network-status.offline {
      background: #dc3545;
      color: white;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .pending-badge {
      position: absolute;
      top: 10px;
      left: 15px;
      background: #ffc107;
      color: #856404;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      display: none;
    }
    
    .pending-badge.show {
      display: block;
      animation: bounce 1s infinite;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    .form-container {
      padding: 25px 20px;
      display: none;
    }
    
    .form-group {
      margin-bottom: 18px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }
    
    select, input[type="number"], input[type="text"] {
      width: 100%;
      padding: 14px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s;
      background: white;
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    input[type="number"] {
      appearance: textfield;
      -moz-appearance: textfield;
    }
    
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    .searchable-dropdown {
      position: relative;
    }
    
    .searchable-dropdown input {
      cursor: text;
      padding-right: 40px;
    }
    
    .dropdown-arrow {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      color: #666;
      font-size: 12px;
    }
    
    .dropdown-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 250px;
      overflow-y: auto;
      background: white;
      border: 2px solid #667eea;
      border-top: none;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      display: none;
      z-index: 1000;
      margin-top: -10px;
    }
    
    .dropdown-list.show {
      display: block;
    }
    
    .dropdown-item {
      padding: 12px 15px;
      cursor: pointer;
      transition: background 0.2s;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .dropdown-item:hover {
      background: #f8f9ff;
    }
    
    .dropdown-item:last-child {
      border-bottom: none;
    }
    
    .dropdown-item.active {
      background: #667eea;
      color: white;
    }
    
    .no-results {
      padding: 12px 15px;
      color: #999;
      text-align: center;
      font-style: italic;
    }
    
    .highlight {
      background: #ffeb3b;
      font-weight: 600;
      padding: 0 2px;
    }
    
    .btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 10px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn.offline-mode {
      background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
    }
    
    .message {
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: none;
      font-size: 14px;
      animation: slideIn 0.3s ease;
      font-weight: 500;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .message.success {
      background: #d4edda;
      color: #155724;
      border: 2px solid #c3e6cb;
    }
    
    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid #f5c6cb;
    }
    
    .message.warning {
      background: #fff3cd;
      color: #856404;
      border: 2px solid #ffc107;
    }
    
    .loading {
      text-align: center;
      padding: 30px 20px;
      color: #667eea;
    }
    
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .info-text {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
      font-style: italic;
    }
    
    .speed-badge {
      display: inline-block;
      background: #28a745;
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 11px;
      margin-left: 8px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="network-status online" id="networkStatus">
        <span>‚óè</span> Online
      </div>
      <div class="pending-badge" id="pendingBadge">
        üì¶ <span id="pendingCount">0</span> ch·ªù g·ª≠i
      </div>
      <h1>üì¶ Nh·∫≠p Li·ªáu S·∫£n Xu·∫•t</h1>
      <p>Th√†nh ph·∫©m giao ƒë√≥ng th√πng theo ƒë∆°n h√†ng <span class="speed-badge">‚ö° OFFLINE OK</span></p>
    </div>
    
    <div id="loadingDiv" class="loading">
      <div class="spinner"></div>
      <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
      <p style="font-size: 11px; margin-top: 5px; opacity: 0.7;">L·∫ßn ƒë·∫ßu c√≥ th·ªÉ m·∫•t 2-3s</p>
    </div>
    
    <div class="form-container" id="formContainer">
      <div id="messageDiv" class="message"></div>
      
      <form id="dataForm">
        <div class="form-group">
          <label for="nhanVien">üë§ T√™n C√¥ng Nh√¢n:</label>
          <select id="nhanVien" required>
            <option value="">-- Ch·ªçn c√¥ng nh√¢n --</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="donHangInput">üìã ƒê∆°n H√†ng:</label>
          <div class="searchable-dropdown">
            <input 
              type="text" 
              id="donHangInput" 
              placeholder="G√µ ƒë·ªÉ t√¨m ho·∫∑c nh·∫•n ƒë·ªÉ xem t·∫•t c·∫£..." 
              autocomplete="off"
              required>
            <span class="dropdown-arrow">‚ñº</span>
            <div class="dropdown-list" id="donHangList"></div>
          </div>
          <p class="info-text">üí° G√µ ƒë·ªÉ t√¨m nhanh (vd: "12" ‚Üí A12, B12, C12...)</p>
        </div>
        
        <div class="form-group">
          <label for="size">üìè Size:</label>
          <select id="size" required disabled>
            <option value="">-- Ch·ªçn ƒë∆°n h√†ng tr∆∞·ªõc --</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="mau">üé® M√†u S·∫Øc:</label>
          <select id="mau" required disabled>
            <option value="">-- Ch·ªçn size tr∆∞·ªõc --</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="soLuong">üî¢ S·ªë L∆∞·ª£ng:</label>
          <input type="number" id="soLuong" min="1" required placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng" inputmode="numeric">
        </div>
        
        <button type="submit" class="btn" id="submitBtn">‚úÖ L∆∞u D·ªØ Li·ªáu</button>
      </form>
    </div>
  </div>

  <script>
    // ============================================
    // ‚ö†Ô∏è PASTE URL GOOGLE APPS SCRIPT V√ÄO ƒê√ÇY
    // ============================================
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxtfBgBK1e_cbuD9yi1vjINxxQ4ri0OiY2IZtpZQpzA3-WmHaFdqg5FqYXcArEsPagf/exec';
    // ============================================
    
    let allData = {};
    let callbackId = 0;
    let selectedDonHang = '';
    let allDonHangs = [];
    let isOnline = navigator.onLine;
    let pendingQueue = [];
    
    // KH·ªûI T·∫†O
    window.addEventListener('load', function() {
      if (SCRIPT_URL === 'PASTE_URL_APPS_SCRIPT_·ªû_ƒê√ÇY' || !SCRIPT_URL) {
        document.getElementById('loadingDiv').innerHTML = 
          '<p style="color: red; padding: 20px;">‚ùå Ch∆∞a c·∫•u h√¨nh URL!</p>' +
          '<p style="font-size: 13px; padding: 0 20px;">S·ª≠a d√≤ng: <code>const SCRIPT_URL = ...</code></p>';
        return;
      }
      
      // Load pending queue t·ª´ localStorage
      loadPendingQueue();
      updatePendingBadge();
      
      // Setup network listeners
      setupNetworkListeners();
      
      // Load d·ªØ li·ªáu
      loadInitialData();
    });
    
    // ============================================
    // OFFLINE MODE - QU·∫¢N L√ù H√ÄNG ƒê·ª¢I
    // ============================================
    
    function loadPendingQueue() {
      const saved = localStorage.getItem('pendingQueue');
      if (saved) {
        try {
          pendingQueue = JSON.parse(saved);
          console.log('üì¶ Loaded pending queue:', pendingQueue.length, 'items');
        } catch (e) {
          pendingQueue = [];
        }
      }
    }
    
    function savePendingQueue() {
      localStorage.setItem('pendingQueue', JSON.stringify(pendingQueue));
    }
    
    function addToPendingQueue(data) {
      const item = {
        id: Date.now(),
        timestamp: new Date().toISOString(),
        data: data
      };
      pendingQueue.push(item);
      savePendingQueue();
      updatePendingBadge();
      console.log('üì¶ Added to pending queue:', item);
    }
    
    function updatePendingBadge() {
      const badge = document.getElementById('pendingBadge');
      const count = document.getElementById('pendingCount');
      
      if (pendingQueue.length > 0) {
        count.textContent = pendingQueue.length;
        badge.classList.add('show');
      } else {
        badge.classList.remove('show');
      }
    }
    
    async function processPendingQueue() {
      if (pendingQueue.length === 0 || !isOnline) return;
      
      console.log('üîÑ Processing pending queue:', pendingQueue.length, 'items');
      showMessage('üîÑ ƒêang g·ª≠i ' + pendingQueue.length + ' d·ªØ li·ªáu ƒë√£ l∆∞u...', 'warning');
      
      const itemsToProcess = [...pendingQueue];
      let successCount = 0;
      let failCount = 0;
      
      for (const item of itemsToProcess) {
        try {
          const result = await callScriptFunction('luuDuLieu', { data: item.data });
          
          if (result.success) {
            // Remove from queue
            pendingQueue = pendingQueue.filter(i => i.id !== item.id);
            successCount++;
            console.log('‚úÖ Sent:', item.id);
          } else {
            failCount++;
            console.log('‚ùå Failed:', item.id, result.message);
          }
        } catch (error) {
          failCount++;
          console.error('‚ùå Error sending:', item.id, error);
          break; // D·ª´ng n·∫øu l·ªói network
        }
      }
      
      savePendingQueue();
      updatePendingBadge();
      
      if (successCount > 0) {
        showMessage(`‚úÖ ƒê√£ g·ª≠i th√†nh c√¥ng ${successCount} d·ªØ li·ªáu!`, 'success');
      }
      
      if (failCount > 0 && pendingQueue.length > 0) {
        showMessage(`‚ö†Ô∏è C√≤n ${pendingQueue.length} d·ªØ li·ªáu ch∆∞a g·ª≠i ƒë∆∞·ª£c`, 'warning');
      }
    }
    
    // ============================================
    // NETWORK STATUS
    // ============================================
    
    function setupNetworkListeners() {
      window.addEventListener('online', function() {
        isOnline = true;
        updateNetworkStatus();
        showMessage('‚úÖ ƒê√£ k·∫øt n·ªëi m·∫°ng!', 'success');
        
        // T·ª± ƒë·ªông g·ª≠i d·ªØ li·ªáu ƒëang ch·ªù
        setTimeout(() => {
          processPendingQueue();
        }, 1000);
      });
      
      window.addEventListener('offline', function() {
        isOnline = false;
        updateNetworkStatus();
        showMessage('‚ö†Ô∏è M·∫•t k·∫øt n·ªëi! D·ªØ li·ªáu s·∫Ω l∆∞u t·∫°m v√† g·ª≠i khi c√≥ m·∫°ng.', 'warning');
      });
      
      updateNetworkStatus();
    }
    
    function updateNetworkStatus() {
      const status = document.getElementById('networkStatus');
      const submitBtn = document.getElementById('submitBtn');
      
      if (isOnline) {
        status.innerHTML = '<span>‚óè</span> Online';
        status.className = 'network-status online';
        submitBtn.textContent = '‚úÖ L∆∞u D·ªØ Li·ªáu';
        submitBtn.classList.remove('offline-mode');
      } else {
        status.innerHTML = '<span>‚óè</span> Offline';
        status.className = 'network-status offline';
        submitBtn.textContent = 'üíæ L∆∞u T·∫°m (Offline)';
        submitBtn.classList.add('offline-mode');
      }
    }
    
    // ============================================
    // API CALLS
    // ============================================
    
    function callScriptFunction(action, params = {}) {
      return new Promise((resolve, reject) => {
        const id = ++callbackId;
        const callbackName = 'cb_' + id;
        
        window[callbackName] = function(data) {
          delete window[callbackName];
          if (data.error) {
            reject(new Error(data.error));
          } else {
            resolve(data);
          }
        };
        
        const url = new URL(SCRIPT_URL);
        url.searchParams.append('action', action);
        url.searchParams.append('callback', callbackName);
        
        for (let key in params) {
          url.searchParams.append(key, typeof params[key] === 'object' ? JSON.stringify(params[key]) : params[key]);
        }
        
        const script = document.createElement('script');
        script.src = url.toString();
        script.onerror = () => {
          delete window[callbackName];
          reject(new Error('Failed to load'));
        };
        
        setTimeout(() => {
          if (window[callbackName]) {
            delete window[callbackName];
            reject(new Error('Timeout'));
          }
        }, 30000);
        
        document.head.appendChild(script);
        script.onload = () => setTimeout(() => script.remove(), 100);
      });
    }
    
    // ============================================
    // LOAD DATA
    // ============================================
    
    async function loadInitialData() {
      const startTime = Date.now();
      
      try {
        console.log('‚ö° Loading all data...');
        
        allData = await callScriptFunction('loadAllData');
        allDonHangs = allData.donHangs;
        
        const loadTime = ((Date.now() - startTime) / 1000).toFixed(2);
        console.log(`‚úÖ Load xong trong ${loadTime}s`);
        
        const nhanVienSelect = document.getElementById('nhanVien');
        allData.nhanViens.forEach(nv => {
          const option = document.createElement('option');
          option.value = nv;
          option.textContent = nv;
          nhanVienSelect.appendChild(option);
        });
        
        document.getElementById('loadingDiv').style.display = 'none';
        document.getElementById('formContainer').style.display = 'block';
        
        if (loadTime < 2) {
          showMessage(`‚ö° T·∫£i xong trong ${loadTime}s`, 'success');
        }
        
        // X·ª≠ l√Ω pending queue n·∫øu c√≥
        if (pendingQueue.length > 0 && isOnline) {
          setTimeout(() => processPendingQueue(), 2000);
        }
        
      } catch (error) {
        console.error('‚ùå L·ªói:', error);
        document.getElementById('loadingDiv').innerHTML = 
          '<p style="color: red; font-weight: 600;">‚ùå L·ªói k·∫øt n·ªëi</p>' +
          '<p style="font-size: 13px; margin: 10px 20px;">' + error.message + '</p>' +
          '<button onclick="location.reload()" style="padding: 12px 24px; cursor: pointer; border-radius: 8px; border: none; background: #667eea; color: white; font-weight: 600;">üîÑ Th·ª≠ l·∫°i</button>';
      }
    }
    
    // ============================================
    // SEARCHABLE DROPDOWN
    // ============================================
    
    const donHangInput = document.getElementById('donHangInput');
    const donHangList = document.getElementById('donHangList');
    
    donHangInput.addEventListener('focus', function() {
      renderDropdownList(allDonHangs);
      donHangList.classList.add('show');
    });
    
    donHangInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      
      if (searchTerm === '') {
        renderDropdownList(allDonHangs);
      } else {
        const filtered = allDonHangs.filter(dh => 
          dh.toLowerCase().includes(searchTerm)
        );
        renderDropdownList(filtered, searchTerm);
      }
      
      donHangList.classList.add('show');
    });
    
    function renderDropdownList(items, searchTerm = '') {
      if (items.length === 0) {
        donHangList.innerHTML = '<div class="no-results">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng</div>';
        return;
      }
      
      donHangList.innerHTML = items.map(item => {
        let displayText = item;
        
        if (searchTerm) {
          const regex = new RegExp(`(${searchTerm})`, 'gi');
          displayText = item.replace(regex, '<span class="highlight">$1</span>');
        }
        
        return `<div class="dropdown-item" data-value="${item}">${displayText}</div>`;
      }).join('');
      
      const items_el = donHangList.querySelectorAll('.dropdown-item');
      items_el.forEach(item => {
        item.addEventListener('click', function() {
          selectDonHang(this.getAttribute('data-value'));
        });
      });
    }
    
    function selectDonHang(value) {
      selectedDonHang = value;
      donHangInput.value = value;
      donHangList.classList.remove('show');
      loadSizeAndColor(value);
    }
    
    document.addEventListener('click', function(e) {
      if (!donHangInput.contains(e.target) && !donHangList.contains(e.target)) {
        donHangList.classList.remove('show');
      }
    });
    
    let currentFocusIndex = -1;
    
    donHangInput.addEventListener('keydown', function(e) {
      const items = donHangList.querySelectorAll('.dropdown-item');
      
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        currentFocusIndex++;
        if (currentFocusIndex >= items.length) currentFocusIndex = 0;
        setActiveItem(items);
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        currentFocusIndex--;
        if (currentFocusIndex < 0) currentFocusIndex = items.length - 1;
        setActiveItem(items);
      } else if (e.key === 'Enter') {
        e.preventDefault();
        if (currentFocusIndex > -1 && items[currentFocusIndex]) {
          selectDonHang(items[currentFocusIndex].getAttribute('data-value'));
          currentFocusIndex = -1;
        }
      } else if (e.key === 'Escape') {
        donHangList.classList.remove('show');
        currentFocusIndex = -1;
      }
    });
    
    function setActiveItem(items) {
      items.forEach((item, index) => {
        if (index === currentFocusIndex) {
          item.classList.add('active');
          item.scrollIntoView({ block: 'nearest' });
        } else {
          item.classList.remove('active');
        }
      });
    }
    
    function loadSizeAndColor(donHang) {
      const sizeSelect = document.getElementById('size');
      const mauSelect = document.getElementById('mau');
      
      sizeSelect.innerHTML = '<option value="">-- Ch·ªçn size --</option>';
      mauSelect.innerHTML = '<option value="">-- Ch·ªçn size tr∆∞·ªõc --</option>';
      mauSelect.disabled = true;
      
      const sizeMauData = allData.sizeMauMapping[donHang];
      
      if (sizeMauData && sizeMauData.sizes.length > 0) {
        sizeMauData.sizes.forEach(size => {
          const option = document.createElement('option');
          option.value = size;
          option.textContent = size;
          sizeSelect.appendChild(option);
        });
        sizeSelect.disabled = false;
        window.currentSizeMauData = sizeMauData;
      } else {
        sizeSelect.innerHTML = '<option value="">-- Kh√¥ng c√≥ size --</option>';
        sizeSelect.disabled = true;
      }
    }
    
    document.getElementById('size').addEventListener('change', function() {
      const size = this.value;
      const mauSelect = document.getElementById('mau');
      
      mauSelect.innerHTML = '<option value="">-- Ch·ªçn m√†u --</option>';
      
      if (size && window.currentSizeMauData && window.currentSizeMauData.colors[size]) {
        window.currentSizeMauData.colors[size].forEach(mau => {
          const option = document.createElement('option');
          option.value = mau;
          option.textContent = mau;
          mauSelect.appendChild(option);
        });
        mauSelect.disabled = false;
      } else {
        mauSelect.disabled = true;
      }
    });
    
    // ============================================
    // SUBMIT FORM
    // ============================================
    
    document.getElementById('dataForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      if (!selectedDonHang) {
        showMessage('‚ö†Ô∏è Vui l√≤ng ch·ªçn ƒë∆°n h√†ng t·ª´ danh s√°ch!', 'error');
        donHangInput.focus();
        return;
      }
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      const originalText = submitBtn.textContent;
      submitBtn.textContent = isOnline ? '‚è≥ ƒêang l∆∞u...' : 'üíæ ƒêang l∆∞u t·∫°m...';
      
      const data = {
        nhanVien: document.getElementById('nhanVien').value,
        donHang: selectedDonHang,
        size: document.getElementById('size').value,
        mau: document.getElementById('mau').value,
        soLuong: parseInt(document.getElementById('soLuong').value)
      };
      
      try {
        if (!isOnline) {
          // OFFLINE: L∆∞u v√†o queue
          addToPendingQueue(data);
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
          showMessage('üíæ ƒê√£ l∆∞u t·∫°m! S·∫Ω g·ª≠i khi c√≥ m·∫°ng.', 'warning');
          document.getElementById('soLuong').value = '';
          document.getElementById('soLuong').focus();
          return;
        }
        
        // ONLINE: G·ª≠i ngay
        const result = await callScriptFunction('luuDuLieu', { data: data });
        
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        
        if (result.success) {
          showMessage(result.message, 'success');
          document.getElementById('soLuong').value = '';
          document.getElementById('soLuong').focus();
        } else {
          showMessage(result.message || 'L·ªói l∆∞u', 'error');
        }
        
      } catch (error) {
        console.error('L·ªói:', error);
        
        // N·∫øu l·ªói network ‚Üí l∆∞u v√†o queue
        addToPendingQueue(data);
        
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        showMessage('‚ö†Ô∏è L·ªói g·ª≠i! ƒê√£ l∆∞u t·∫°m, s·∫Ω g·ª≠i l·∫°i khi c√≥ m·∫°ng.', 'warning');
        document.getElementById('soLuong').value = '';
      }
    });
    
    function showMessage(message, type) {
      const messageDiv = document.getElementById('messageDiv');
      messageDiv.textContent = message;
      messageDiv.className = 'message ' + type;
      messageDiv.style.display = 'block';
      
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 3000);
    }
    
    document.getElementById('mau').addEventListener('change', function() {
      if (this.value) {
        document.getElementById('soLuong').focus();
      }
    });
  </script>
</body>
</html>